package org.task.feedbackbot.models.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

import java.util.Arrays;
import java.util.List;
import java.util.Optional;
import java.util.regex.Pattern;

@Getter
@AllArgsConstructor
public enum FeedbackPattern {
    SALARY_ISSUES(
            List.of(
                    "оплата", "платня", "доплата", "заробітна плата", "зарплата", "зарплати", "зарплату",
                    "відсутність грошей", "відсутність коштів", "задержка зарплати", "затримка виплати",
                    "не виплатили", "не нарахували", "премія", "премію", "преміі", "премії", "премією",
                    "нарахування", "нарахували", "виплата", "виплати", "кошти", "грошей", "грошi",

                    "борг по зарплаті", "заборгованість", "невиплата", "затримують", "затримка",
                    "недоплата", "недоплатили", "мало платять", "низька зарплата", "маленька зарплата",
                    "фінансові проблеми", "немає грошей", "не отримав", "не отримала", "винен зарплату",
                    "аванс", "розрахунок", "розрахувати", "виплатіть", "доплатіть", "компенсація",
                    "надбавка", "бонус", "стипендія", "відпускні", "лікарняні", "соціальні виплати"
            ),
            "Терміново вирішити питання оплати праці",
            FeedbackCategory.SALARY,
            CriticalityLevel.CRITICAL
    ),

    EQUIPMENT_BROKEN(
            List.of(
                    "вийшло з ладу", "не включається", "не відповідає", "пошкоджено", "пошкодження",
                    "не працює комп'ютер", "не працює принтер", "зламався", "зламалась", "зламалося",

                    "не функціонує", "вийшов з ладу", "поламався", "поламалась", "поламалося",
                    "не запускається", "глючить", "гальмує", "зависає", "не реагує", "мертвий",
                    "поломка", "несправність", "дефект", "збій", "помилка системи", "крах системи",
                    "не вмикається", "не вимикається", "перегрівається", "шумить", "тріщить",
                    "протікає", "течія", "коротке замикання", "перегорів", "перегоріла", "згорів",
                    "розбитий", "розбита", "розбите", "тріснув", "тріснула", "відвалився",
                    "відключився", "вимкнувся", "зупинився", "застряг", "заклинило"
            ),
            "Відремонтувати обладнання",
            FeedbackCategory.EQUIPMENT,
            CriticalityLevel.HIGH
    ),

    EQUIPMENT_NEEDED(
            List.of(
                    "потрібне обладнання", "хочу інструмент", "замовити обладнання",
                    "не вистачає", "потреба у техніці", "запасний інструмент", "не вистачає матеріалів",

                    "треба купити", "необхідно придбати", "потрібно замовити", "бракує", "немає",
                    "відсутній", "відсутня", "відсутнє", "нема", "закінчився", "закінчилась",
                    "мало інструментів", "старе обладнання", "застаріле", "потрібен новий",
                    "потрібна нова", "потрібне нове", "хочу новий", "хочу нову", "замініть",
                    "оновіть", "модернізуйте", "покращіть", "додайте", "встановіть",
                    "комп'ютер потрібен", "принтер потрібен", "монітор", "клавіатура", "миша",
                    "програмне забезпечення", "ліцензія", "софт", "програма", "додаток"
            ),
            "Розглянути придбання нового обладнання",
            FeedbackCategory.EQUIPMENT,
            CriticalityLevel.MODERATE
    ),

    MANAGEMENT_ISSUES(
            List.of(
                    "проблеми з менеджером", "конфлікт з керівництвом", "неуважний начальник",
                    "погане управління", "недостатній контроль", "відсутність підтримки",
                    "несправедливе ставлення",

                    "поганий керівник", "поганий менеджер", "поганий начальник", "некомпетентний",
                    "не розуміє", "не слухає", "ігнорує", "байдужий", "грубий", "неввічливий",
                    "кричить", "принижує", "образливий", "дискримінація", "упередження",
                    "фаворитизм", "несправедливість", "пристрасть", "тиск", "примус",
                    "погрози", "шантаж", "моббінг", "булінг", "цькування", "переслідування",
                    "відсутність лідерства", "немає керівництва", "хаос", "безлад", "анархія",
                    "не організовано", "плутанина", "неясні завдання", "суперечливі вказівки",
                    "відсутність зворотного зв'язку", "не цінують працівників", "не поважають"
            ),
            "Провести розмову з керівництвом",
            FeedbackCategory.MANAGEMENT,
            CriticalityLevel.HIGH
    ),

    WORKPLACE_CONDITIONS(
            List.of(
                    // Умови праці
                    "погані умови", "холодно", "жарко", "душно", "волого", "сухо", "брудно",
                    "шумно", "темно", "погане освітлення", "немає вентиляції", "протяг",
                    "неудобні меблі", "поганий стілець", "низький стіл", "високий стіл",
                    "тісно", "мало місця", "захаращено", "безлад", "неохайно", "антисанітарія",
                    "погана вода", "немає туалету", "поганий туалет", "немає кухні",
                    "погана кухня", "немає де поїсти", "немає де відпочити", "кімната відпочинку",
                    "паркування", "немає де припаркуватися", "далеко їздити", "погана дорога",
                    "небезпечно", "травмонебезпечно", "порушення техніки безпеки"
            ),
            "Покращити умови праці",
            FeedbackCategory.WORKPLACE,
            CriticalityLevel.MODERATE
    ),

    POSITIVE_FEEDBACK(
            List.of(
                    "гарно", "чудово зроблено", "приємно", "вдячний", "високий рівень",
                    "професійно", "спасибі", "відмінна робота", "позитивно", "приємно здивований",

                    "дякую", "молодці", "класно", "супер", "круто", "відмінно", "прекрасно",
                    "чудово", "фантастично", "неймовірно", "вражаючо", "захоплююче",
                    "задоволений", "задоволена", "радий", "рада", "щасливий", "щаслива",
                    "подобається", "сподобалось", "рекомендую", "похвала", "компліменти",
                    "вдячність", "признательность", "оцінюю", "поважаю", "шаную",
                    "якісно", "швидко", "ефективно", "результативно", "корисно", "допомогли",
                    "підтримали", "зрозуміли", "вислухали", "врахували", "виконали", "зробили"
            ),
            "Продовжувати в тому ж дусі",
            FeedbackCategory.APPRECIATION,
            CriticalityLevel.LOW
    );

    private final List<String> keywords;
    private final String defaultSolution;
    private final FeedbackCategory category;
    private final CriticalityLevel criticalityLevel;

    public boolean matches(String text) {
        String lowerText = text.toLowerCase();
        return keywords.stream().anyMatch(keyword -> {
            final var stem = keyword.length() > 4
                    ? keyword.substring(0, keyword.length() - 2) : keyword;
            return lowerText.contains(stem);
        });
    }

    public static Optional<FeedbackPattern> findBestMatch(String text) {
        return Arrays.stream(values())
                .filter(pattern -> pattern.matches(text))
                .findFirst();
    }

    public static double calculateConfidence(FeedbackPattern pattern) {
        return switch (pattern.getCriticalityLevel()) {
            case CRITICAL -> 0.9;
            case HIGH -> 0.8;
            case MODERATE -> 0.6;
            case LOW, MINOR -> 0.7;
        };
    }
}